(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{38:function(t,e,n){t.exports=n.p+"static/media/no_image.57f701ae.png"},39:function(t,e,n){t.exports=n.p+"static/media/background.c8dead68.png"},43:function(t,e,n){t.exports=n(82)},44:function(t,e,n){},82:function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"setStatus",function(){return E});var r={};n.r(r),n.d(r,"setDimension",function(){return C});var a={};n.r(a),n.d(a,"confirm",function(){return W}),n.d(a,"message",function(){return R}),n.d(a,"showModalButton",function(){return V}),n.d(a,"hideModal",function(){return I});var o={};n.r(o),n.d(o,"cacheUrl",function(){return D}),n.d(o,"setSubView",function(){return M}),n.d(o,"backToHome",function(){return U}),n.d(o,"clearView",function(){return L}),n.d(o,"pushView",function(){return z}),n.d(o,"pullView",function(){return B});var s={};n.r(s),n.d(s,"login",function(){return A}),n.d(s,"logout",function(){return _});var u={};n.r(u),n.d(u,"fetchReports",function(){return K}),n.d(u,"submit",function(){return $}),n.d(u,"setCurrentStage",function(){return q}),n.d(u,"viewReport",function(){return N});n(44);var c=n(0),l=n.n(c),h=n(36),d=n.n(h),p=n(18);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var f=n(7),b=n.n(f),y=n(14),g=n(11),v=n(2),m=n(3),w=n(5),k=n(4),j=n(6),O=n(12),x=n(13),S=n.n(x),E=function(t){return{type:"setStatus",payload:t}},C=function(t){return{type:"setDimension",payload:t}},W=function(t,e,n){return{type:"confirm",payload:{message:t,onConfirm:e,onCancel:n}}},R=function(t){return{type:"message",payload:t}},V=function(){return{type:"showModalButton"}},I=function(){return{type:"hideModal"}},D=function(t,e){return{type:"cacheUrl",payload:{filename:t,url:e}}},M=function(t){return{type:"setSubView",payload:t}},U=function(){return{type:"backToHome"}},L=function(){return{type:"clearView"}},z=function(t){return{type:"pushView",payload:t}},B=function(){return{type:"pullView"}};function F(t){t({type:"loadingMessage",payload:["Connecting...","\u9023\u7dda\u4e2d...","\u8fde\u7ebf\u4e2d..."]})}function H(t){t({type:"message",payload:["Connection error, Please try again!","\u7db2\u7d61\u51fa\u73fe\u554f\u984c\uff0c\u8acb\u518d\u8a66\u4e00\u6b21!","\u7f51\u7edc\u51fa\u73b0\u95ee\u9898\uff0c\u8bf7\u518d\u8bd5\u4e00\u6b21!"]})}function T(t){return t.then(function(t){return[null,t]}).catch(function(t){return[t]})}var G=T,P="https://sitetracker.io";function A(t,e){return console.log(P),console.log(t+" "+e),function(){var t=Object(g.a)(b.a.mark(function t(e){var n,i,r,a;return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return F(e),t.next=3,G(S.a.get(P+"/user/login",{headers:{id:"abc",pw:"123"}}));case 3:if(r=t.sent,a=Object(y.a)(r,2),n=a[0],i=a[1],!n){t.next=10;break}return H(e),t.abrupt("return");case 10:"succeed"===i.data.result?(console.log(i.data),e({type:"setUser",payload:i.data.user}),e({type:"setStatus",payload:"ready"}),e({type:"hideModal"})):e({type:"message",payload:["Login failed! Invalid id or password!","\u767b\u5165\u5931\u6557! \u540d\u7a31\u6216\u5bc6\u78bc\u4e0d\u6b63\u78ba!","\u767b\u5165\u5931\u8d25! \u540d\u79f0\u6216\u5bc6\u7801\u4e0d\u6b63\u786e!"]});case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}function _(){return function(t){window.location.reload()}}var Z=n(1),Y=T,J="https://sitetracker.io";function K(){return function(){var t=Object(g.a)(b.a.mark(function t(e){var n,i,r,a;return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Y(S.a.get(J+"/report/fetchAll"));case 2:if(r=t.sent,a=Object(y.a)(r,2),n=a[0],i=a[1],!n){t.next=9;break}return H(e),t.abrupt("return");case 9:"succeed"===i.data.result?e({type:"updateReports",payload:i.data.reports}):H(e);case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}function $(t,e,n){return function(){var i=Object(g.a)(b.a.mark(function i(r){var a,o,s,u,c,l,h,d,p,f,g,v,m,w,k;return b.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return F(r),(a=new FormData).append("files",e,"photo.png"),(o=new FormData).append("files",n,"signature.png"),i.next=7,Y(S.a.post(J+"/upload",a,{headers:{type:"photo"}}));case 7:if(h=i.sent,d=Object(y.a)(h,2),s=d[0],u=d[1],!s){i.next=14;break}return H(r),i.abrupt("return");case 14:return i.next=16,Y(S.a.post(J+"/upload",o,{headers:{type:"signature"}}));case 16:if(p=i.sent,f=Object(y.a)(p,2),s=f[0],c=f[1],!s){i.next=23;break}return H(r),i.abrupt("return");case 23:return g=u.data.filenames[0],v=c.data.filenames[0],m=Object(Z.a)({},t,{photo:g,signature:v}),i.next=28,Y(S.a.post(J+"/report/add",{data:{report:m,latitude:t.geoLocated.latitude,longitude:t.geoLocated.longitude}}));case 28:if(w=i.sent,k=Object(y.a)(w,2),s=k[0],l=k[1],!s){i.next=35;break}return H(r),i.abrupt("return");case 35:"succeed"===l.data.result?(r({type:"hideModal"}),r({type:"updateReports",payload:[l.data.report]}),r({type:"viewReport",payload:{submitted:!0}}),r({type:"setCurrentStage",payload:4})):(console.log(l.data.result),r({type:"message",payload:["Submit failed! Please try again!","\u63d0\u4ea4\u5931\u6557! \u8acb\u518d\u8a66\u4e00\u6b21!","\u63d0\u4ea4\u5931\u8d25! \u8bf7\u518d\u8bd5\u4e00\u6b21!"]}));case 36:case"end":return i.stop()}},i,this)}));return function(t){return i.apply(this,arguments)}}()}var q=function(t){return{type:"setCurrentStage",payload:t}},N=function(t){return{type:"viewReport",payload:t}},Q=function(){function t(e){Object(v.a)(this,t),this.init(e)}return Object(m.a)(t,[{key:"init",value:function(t){this.func=t.functions,this.actions=t.actions}},{key:"getUrl",value:function(){var t=Object(g.a)(b.a.mark(function t(e,n){var i;return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.func.url(e,n);case 2:if(i=t.sent,this.unmounted||!i||i===this.url){t.next=10;break}if(this.url=i,!this.useBlob){t.next=9;break}return t.next=8,this.urlToBlob(i);case 8:this.blob=t.sent;case 9:this.actions.main.setStatus("ready");case 10:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"urlToBlob",value:function(){var t=Object(g.a)(b.a.mark(function t(e){var n,i;return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",null);case 2:return t.next=4,fetch(e).catch(function(t){return null});case 4:return n=t.sent,t.next=7,n.blob().catch(function(t){return null});case 7:return i=t.sent,t.abrupt("return",i);case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.unmounted=!0}}]),t}(),X=function(){function t(e){Object(v.a)(this,t),this.init(e)}return Object(m.a)(t,[{key:"init",value:function(t){this.app=t,this.ui=t.store.ui,this.bs=this.ui.basicStyle,this.func=t.functions,this.actions=t.actions}},{key:"rectGreen",value:function(t,e,n){var i={width:e[0],height:e[1],background:"linear-gradient(to bottom, #008901 0%, #91c33b 100%)",color:"white",fontWeight:"bold",fontSize:"100%",borderStyle:"solid",borderWidth:"1px",borderColor:"#008901"};return this.button(i,t,"",n,"rectGreen")}},{key:"standard",value:function(t,e,n){var i={width:.125*this.bs.width,height:.045*this.bs.width,background:t,color:"white",fontWeight:"normal",fontSize:.02*this.bs.width};return this.button(i,e,"",n,"standard"+e)}},{key:"button",value:function(t,e,n,i,r){var a=Object(Z.a)({},tt.button,t);return n&&""!==n&&(a=Object(Z.a)({},a,{backgroundImage:"url("+n+")"})),l.a.createElement("button",{style:a,key:r,onClick:i},this.func.multiLang(e[0],e[1],e[2]))}}]),t}(),tt={button:{border:"none",cursor:"pointer",backgroundSize:"100% 100%",backgroundColor:"transparent",fontWeight:"bold",fontSize:"100%",color:"white",flexShrink:0,position:"relative"}},et=X,nt=function(){function t(e){Object(v.a)(this,t),this.init(e)}return Object(m.a)(t,[{key:"init",value:function(t){this.app=t,this.ui=t.store.ui,this.bs=this.ui.basicStyle,this.func=t.functions}},{key:"optionBar",value:function(t,e,n,i,r){var a={width:e[0],height:e[1],fontSize:"125%",display:"flex",flexFlow:"row nowrap",justifyContent:"center",backgroundColor:"white",flexShrink:0};return l.a.createElement("select",{id:t,style:a,defaultValue:i,onChange:r?function(t){r(t)}:null},n.map(function(t,e){return l.a.createElement("option",{key:e},t)}))}},{key:"dateField",value:function(t,e,n){return l.a.createElement("input",{id:t,type:e,defaultValue:n,style:{width:"50%",height:"4%",fontSize:"100%",margin:"2%",flexShrink:0}})}},{key:"textArea",value:function(t,e,n,i,r,a){var o={width:r?r[0]:.67*this.bs.width,height:r?r[1]:.15*this.bs.height,fontSize:a||"175%",flexShrink:0};return l.a.createElement("textarea",{id:t,style:o,defaultValue:n,onChange:i||null,placeholder:e?this.func.multiLang(e[0],e[1],e[2]):""})}},{key:"inputField",value:function(t,e,n,i,r,a){var o={width:i[0],height:i[1],fontSize:i[1],color:this.ui.colors.grey,flexShrink:0};return l.a.createElement("input",{id:t,type:e,style:o,placeholder:this.func.multiLang(n[0],n[1],n[2]),defaultValue:r,onChange:a})}}]),t}(),it=function(t){function e(){var t,n;Object(v.a)(this,e);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(w.a)(this,(t=Object(k.a)(e)).call.apply(t,[this].concat(r)))).url=new Q(n.props.app),n.buttons=new et(n.props.app),n.inputs=new nt(n.props.app),n}return Object(j.a)(e,t),Object(m.a)(e,[{key:"componentWillReceiveProps",value:function(t){this.init(t),this.checkUrl()}},{key:"checkUrl",value:function(){this.state&&this.state.filename&&this.url.getUrl(this.state.filename,this.state.type)}},{key:"init",value:function(t){this.app=t.app,this.ui=this.app.store.ui,this.bs=this.ui.basicStyle,this.store=this.app.store,this.func=this.app.functions,this.db=this.app.database,this.actions=this.app.actions,this.url.init(t.app)}},{key:"textDisplay",value:function(t,e,n,i,r,a){var o={width:e?e[0]:"100%",height:e?e[1]:"",margin:"1%",fontSize:n||"100%",fontWeight:"normal",textAlign:i||"left",overflow:"hidden",overflowWrap:"break-word",color:r||this.ui.colors.textGrey,flexShrink:0};return l.a.createElement("div",{key:a||"defaultKey"+t,style:o},t)}},{key:"gap",value:function(t){return l.a.createElement("div",{style:{height:t,width:"100%",flexShrink:0}})}},{key:"sep",value:function(){return l.a.createElement("div",{style:{height:"1px",width:"100%",backgroundColor:"black",opacity:.15,flexShrink:0}})}},{key:"verGap",value:function(t){return l.a.createElement("div",{style:{minWidth:t,height:"100%",flexShrink:0}})}},{key:"verSep",value:function(t,e){return l.a.createElement("div",{style:{backgroundColor:t,width:"1px",height:e,flexShrink:0}})}}]),e}(c.Component),rt=function(t){function e(){return Object(v.a)(this,e),Object(w.a)(this,Object(k.a)(e).apply(this,arguments))}return Object(j.a)(e,t),Object(m.a)(e,[{key:"title",value:function(){var t={color:this.ui.colors.green,fontSize:.1*this.bs.height,fontWeight:"bold"};return l.a.createElement("div",{style:t},"SiteTracker")}},{key:"render",value:function(){var t=this;this.init(this.props);var e=[.35*this.bs.width,.035*this.bs.width];return l.a.createElement("div",{style:Object(Z.a)({},this.bs,{justifyContent:"center"})},this.title(),this.gap("6%"),this.inputs.inputField("id","text",["Login id","\u767b\u5165\u540d\u7a31"],e),this.gap("3%"),this.inputs.inputField("pw","password",["Password","\u5bc6\u78bc"],e),this.gap("6%"),this.buttons.rectGreen(["Login","\u767b\u5165"],e,function(){t.login()}))}},{key:"login",value:function(t,e){var n=t||document.getElementById("id").value,i=e||document.getElementById("pw").value;this.props.app.actions.user.login(n,i)}}]),e}(it),at=n(8),ot=function(t){function e(t){var n;return Object(v.a)(this,e),(n=Object(w.a)(this,Object(k.a)(e).call(this,t))).init(t),n.state={},n}return Object(j.a)(e,t),Object(m.a)(e,[{key:"componentWillReceiveProps",value:function(t){this.checkViewTransition(t)}},{key:"checkViewTransition",value:function(t){this.state&&this.setState({view:t.app.store.content.subView,deadView:this.state.view!==t.app.store.content.subView?this.state.view:this.state.deadView})}},{key:"animatedView",value:function(t,e,n,i){var r=this,a=i||{stiffness:100,damping:50,precision:3};return l.a.createElement(at.Motion,{key:e,defaultStyle:{opacity:n?0:1},style:{opacity:n?Object(at.spring)(1,a):Object(at.spring)(0,a)},onRest:n?null:function(){r.setState({deadView:null})}},function(n){return t(e,n)})}},{key:"animatedSubView",value:function(t,e,n){return this.animatedView(t,e,n,{stiffness:1e3,damping:50,precision:9})}},{key:"viewStyle",value:function(){return Object(Z.a)({},this.bs,{height:1*this.bs.height,position:"relative",justifyContent:"flex-start",alignItems:"center",overflowY:"auto",backgroundColor:"white",opacity:this.app.animatedStyle.opacity,pointerEvents:1===this.app.animatedStyle.opacity?"":"none"})}},{key:"viewContentStyle",value:function(){return{width:"100%",display:"flex",flexFlow:"column nowrap",flexShrink:0,justifyContent:"flex-start",alignItems:"center",overflowY:"auto",backgroundColor:"white"}}}]),e}(it),st=n(38),ut=n.n(st),ct=function(t){function e(t){var n;return Object(v.a)(this,e),(n=Object(w.a)(this,Object(k.a)(e).call(this,t))).content=function(t){return l.a.createElement("div",{style:Object(Z.a)({},n.rowStyle(),{height:t.height,opacity:t.opacity*n.outDated?.5:1})},n.lastModified(),n.description(),n.submitTime(),n.category(),n.subCategory(),n.verSep(n.ui.colors.lightGrey,"75%"),n.region(),n.status(),n.coordinate(),n.verSep(n.ui.colors.lightGrey,"75%"),n.reporter(),n.signature())},n.init(t),n.state={filename:n.props.report?n.props.report.photo:null,type:"photo"},n.checkUrl(),n}return Object(j.a)(e,t),Object(m.a)(e,[{key:"componentWillReceiveProps",value:function(t){this.init(t),t.report&&!this.state.filename&&this.setState({filename:t.report.photo,type:"photo"}),this.checkUrl()}},{key:"rowInfo",value:function(){var t=this.props.report,e=Object(Z.a)({},this.ui.styles.area,{width:"100%",height:.06*this.bs.height,justifyContent:"flex-start",alignItems:"flex-end"});return l.a.createElement("div",{style:e},this.textDisplay(this.func.dateString(new Date(t.createdAt)),["",""],"150%","",this.ui.colors.lightGrey))}},{key:"render",value:function(){return null===this.props.report?null:this.animatedRow(this.content.bind(this),.2*this.bs.height)}},{key:"text",value:function(t){return this.textDisplay(t,["100%",.025*this.bs.height],.01*this.bs.width,"center",this.ui.colors.textGrey)}},{key:"itemStyle",value:function(t){return Object(Z.a)({},this.bs,{width:t||.15*this.bs.width,height:.2*this.bs.height,justifyContent:"flex-start",marginTop:"1%"})}},{key:"lastModified",value:function(){return l.a.createElement("div",{style:this.itemStyle(.16*this.bs.width)},this.rowIcon(),this.gap("5%"),this.text(this.func.dateString(new Date(this.props.report.createdAt))))}},{key:"description",value:function(){return l.a.createElement("div",{style:this.itemStyle()},this.text("description"))}},{key:"submitTime",value:function(){return l.a.createElement("div",{style:this.itemStyle()},this.text(this.func.dateString(new Date(this.props.report.createdAt))))}},{key:"category",value:function(){return l.a.createElement("div",{style:this.itemStyle()},this.text("category"))}},{key:"subCategory",value:function(){return l.a.createElement("div",{style:this.itemStyle()},this.text(this.props.report.problem))}},{key:"region",value:function(){return l.a.createElement("div",{style:this.itemStyle()},this.text("region"))}},{key:"status",value:function(){return l.a.createElement("div",{style:this.itemStyle()},this.text("status"))}},{key:"coordinate",value:function(){return l.a.createElement("div",{style:this.itemStyle()},this.text(this.props.report.geoLocated.latitude),this.text(this.props.report.geoLocated.longitude))}},{key:"reporter",value:function(){return l.a.createElement("div",{style:this.itemStyle()},this.text("reporter"))}},{key:"signature",value:function(){return l.a.createElement("div",{style:this.itemStyle()},this.text("provided"))}}]),e}(function(t){function e(){return Object(v.a)(this,e),Object(w.a)(this,Object(k.a)(e).apply(this,arguments))}return Object(j.a)(e,t),Object(m.a)(e,[{key:"alertTag",value:function(){var t={width:.04*this.bs.height,height:.04*this.bs.height};return l.a.createElement("div",{style:t},this.animatedAlert())}},{key:"rowContent",value:function(t,e){var n=Object(Z.a)({},this.bs,{width:"75%",height:.12*this.bs.height,marginLeft:.02*this.bs.height});return l.a.createElement("div",{style:n},this.rowTitle(t),e())}},{key:"rowTitle",value:function(t){if(!t)return null;var e={width:"100%",height:.06*this.bs.height,fontWeight:"bold",fontSize:.04*this.bs.width,textAlign:"left",color:this.ui.colors.textGrey};return l.a.createElement("div",{style:e},t)}},{key:"rowIcon",value:function(t,e){var n=.12*this.bs.height,i=.11*this.bs.height,r=Object(Z.a)({},this.ui.styles.border,this.ui.styles.container,{width:n,height:n,backgroundColor:"white",position:"relative",borderRadius:5}),a=Object(Z.a)({},this.ui.styles.border,{maxWidth:i,maxHeight:i,backgroundColor:"white"}),o=e||(this.url.url?this.url.url:ut.a);return l.a.createElement("div",{style:r},l.a.createElement("img",{key:o,style:a,src:o,alt:""}))}},{key:"animatedRow",value:function(t,e,n){var i={stiffness:n?200:300,damping:26,precision:1.2};return l.a.createElement(at.Motion,{defaultStyle:{height:n?e:0,opacity:n?1.1:0},style:{height:Object(at.spring)(n?0:e,i),opacity:Object(at.spring)(n?0:1.1,i)}},function(e){return t(e)})}},{key:"animatedFadingRow",value:function(t,e){return l.a.createElement(at.Motion,{defaultStyle:{opacity:0},style:{opacity:Object(at.spring)(e?1:.25,{stiffness:1e3,damping:50,precision:2})}},function(e){return t(e)})}},{key:"rowStyle",value:function(){return Object(Z.a)({},this.ui.styles.area,this.ui.styles.border,{flexShrink:0,width:"98%",alignItems:"center",position:"relative",borderRadius:5,margin:"1%"})}}]),e}(it)),lt=function(t){function e(){return Object(v.a)(this,e),Object(w.a)(this,Object(k.a)(e).apply(this,arguments))}return Object(j.a)(e,t),Object(m.a)(e,[{key:"componentDidMount",value:function(){this.actions.report.fetchReports()}},{key:"topBar",value:function(){var t=Object(Z.a)({},this.ui.styles.area,{width:this.bs.width,height:.1*this.bs.width,backgroundColor:"transparent",alignItems:"center"});return l.a.createElement("div",{style:t},this.verGap("5%"),this.inputs.inputField("search","text","",["50%",.03*this.bs.width],"",function(){}),this.verGap("30%"),this.buttons.standard(this.ui.colors.blue,["Export .csv","\u6c47\u51fa .csv",""],function(){}))}},{key:"table",value:function(){var t=Object(Z.a)({},this.bs,{width:this.bs.width,height:.9*this.bs.height,backgroundColor:"transparent"});return l.a.createElement("div",{style:t},this.tableBar(),this.reportRows())}},{key:"tableBar",value:function(){var t=Object(Z.a)({},this.ui.styles.area,{width:this.bs.width,height:.035*this.bs.width,backgroundColor:this.ui.colors.deepBlue});return l.a.createElement("div",{style:t},this.tableBarItems())}},{key:"tableBarItems",value:function(){var t=Object(Z.a)({},this.ui.styles.area,{alignItems:"center",justifyContent:"center",width:"100%",fontSize:.01*this.bs.width,color:"white"});return["Last Modified","Description","Submit Time","Category","Sub-Category","Region","Status","Coordinate","Reporter","Signature"].map(function(e,n){return l.a.createElement("div",{key:n,style:t},e)})}},{key:"reportRows",value:function(){var t=this,e=Object(Z.a)({},this.bs,{width:"100%",height:"100%",overflow:"auto"});return l.a.createElement("div",{style:e},this.store.report.reports.map(function(e,n){return l.a.createElement(ct,{index:n,app:t.app,report:e})}))}},{key:"render",value:function(){return this.init(this.props),l.a.createElement("div",{style:this.viewStyle()},this.topBar(),this.table())}}]),e}(ot),ht=function(t){function e(){return Object(v.a)(this,e),Object(w.a)(this,Object(k.a)(e).apply(this,arguments))}return Object(j.a)(e,t),Object(m.a)(e,[{key:"componentDidMount",value:function(){this.actions.content.pushView("entry")}},{key:"componentWillReceiveProps",value:function(t){this.setState({view:t.app.store.content.view,deadView:this.state.view!==t.app.store.content.view?this.state.view:this.state.deadView})}},{key:"views",value:function(t,e){var n=this.app;if(n.animatedStyle=e,""===t)return null;switch(t){case"entry":return l.a.createElement(lt,{app:n});default:return null}}},{key:"render",value:function(){this.init(this.props);var t=Object(Z.a)({},this.ui.basicStyle,{justifyContent:"flex-start",background:"transparent",backgroundSize:"100% 100%",position:"relative",backgroundColor:"white"}),e=this.state.deadView,n=this.state.view;return l.a.createElement("div",{style:t},this.animatedView(this.views.bind(this),e||n,!e))}}]),e}(ot),dt=function(t){function e(){return Object(v.a)(this,e),Object(w.a)(this,Object(k.a)(e).apply(this,arguments))}return Object(j.a)(e,t),Object(m.a)(e,[{key:"page",value:function(){var t=this.props.app;switch(t.store.main.status){case"waitForLogin":return l.a.createElement(rt,{app:t});case"ready":return l.a.createElement(ht,{app:t});default:return l.a.createElement("div",null)}}},{key:"render",value:function(){return l.a.createElement("div",{style:this.bs},this.page())}}]),e}(c.Component),pt=function(t){function e(){return Object(v.a)(this,e),Object(w.a)(this,Object(k.a)(e).apply(this,arguments))}return Object(j.a)(e,t),Object(m.a)(e,[{key:"componentDidMount",value:function(){this.count=0}},{key:"componentWillReceiveProps",value:function(t){this.count=this.count+1}},{key:"board",value:function(){var t={width:.4*this.bs.height,height:.2*this.bs.height,borderRadius:"20px",backgroundImage:"",backgroundSize:"100% 100%",display:"flex",flexFlow:"column nowrap",alignItems:"center",justifyContent:"flex-end"};return l.a.createElement("div",{style:t},l.a.createElement("div",{style:{height:"10%"}}),this.message(),this.buttonsArea())}},{key:"message",value:function(){var t=this.store.modal[this.store.main.language];return l.a.createElement("div",{style:ft},t)}},{key:"buttonsArea",value:function(){var t=this,e=this.store.modal.button,n="off"!==e,i="confirm"===e?this.store.modal.onConfirm:function(){},r=this.store.modal.onCancel?this.store.modal.onCancel:function(){};return l.a.createElement("div",{style:{width:"85%",height:"65%",backgroundColor:"transparent",display:"flex",flexFlow:"row nowrap",justifyContent:"space-around",alignItems:"center",flexShrink:0}},n&&this.button(["Confirm","\u78ba\u5b9a","\u786e\u5b9a"],function(){i(),t.actions.modal.hideModal()}),"confirm"===e&&this.button(["Cancel","\u53d6\u6d88","\u53d6\u6d88"],function(){r(),t.actions.modal.hideModal()}))}},{key:"button",value:function(t,e){return this.buttons.button(ft,t,"",e)}},{key:"render",value:function(){var t=this;this.init(this.props);var e=this.store.modal.status,n="off"!==e,i={position:"absolute",width:this.bs.width,height:this.bs.height,minHeight:this.bs.minHeight,backgroundColor:"rgba(0,0,0,0.5)",opacity:1,display:"flex",justifyContent:"center",alignItems:"center",pointerEvents:n?"auto":"none"};return l.a.createElement(at.Motion,{defaultStyle:{opacity:0},style:{opacity:n?Object(at.spring)(1.5):Object(at.spring)(0)}},function(n){return l.a.createElement("div",{key:e+t.count,style:Object(Z.a)({},i,{opacity:n.opacity})},t.board())})}}]),e}(it),ft={borderRadius:"20px",backgroundColor:"rgba(255,255,255,0.9)",color:"black",fontFamily:"adobestdb",fontSize:"100%",fontWeight:"bold",textAlign:"center",padding:"5%",writingMode:"horizontal-lr"},bt=pt,yt=n(39),gt=n.n(yt),vt=function(t){function e(){return Object(v.a)(this,e),Object(w.a)(this,Object(k.a)(e).apply(this,arguments))}return Object(j.a)(e,t),Object(m.a)(e,[{key:"componentDidMount",value:function(){this.init(this.props),this.actions.main.setStatus("ready")}},{key:"componentWillReceiveProps",value:function(t){this.init(this.props)}},{key:"render",value:function(){this.init(this.props);var t={width:.9999*this.ui.windowWidth,height:.9999*this.ui.windowHeight,minHeight:this.bs.height,backgroundImage:"url("+gt.a+")",backgroundSize:"10% 10%",display:"flex",flexFlow:"row nowrap",justifyContent:"center",boxSizing:"border-box",overflow:"hidden"};return l.a.createElement("div",{style:t},l.a.createElement(dt,{app:this.app}),l.a.createElement(bt,{app:this.app}))}}]),e}(it),mt=function(t){function e(){return Object(v.a)(this,e),Object(w.a)(this,Object(k.a)(e).apply(this,arguments))}return Object(j.a)(e,t),Object(m.a)(e,[{key:"api",value:function(){return this.isDev()?"http://localhost:3000":"https://sitetracker.io"}},{key:"isDev",value:function(){return!1}},{key:"addZeroIfSingle",value:function(t){return t<10?"0"+String(t):""+String(t)}},{key:"dateString",value:function(t){var e=t.getFullYear(),n=t.getMonth()+1,i=t.getDate(),r=t.getHours(),a=t.getMinutes();return e+"-"+this.addZeroIfSingle(n)+"-"+this.addZeroIfSingle(i)+" "+this.addZeroIfSingle(r)+":"+this.addZeroIfSingle(a)}},{key:"multiLang",value:function(t,e,n){switch(this.props.store.main.language){case"english":return t;case"chinese":return e;case"simplified_chinese":return n;default:return t}}},{key:"url",value:function(){var t=Object(g.a)(b.a.mark(function t(e,n){var i,r,a,o,s,u,c,l,h,d;return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.props.actions.content,e){t.next=3;break}return t.abrupt("return","");case 3:if(!(r=this.props.store.content.cachedUrl[e])){t.next=9;break}if("processing..."!==r){t.next=8;break}return t.abrupt("return","");case 8:return t.abrupt("return",r);case 9:return i.cacheUrl(e,"processing..."),t.next=12,this.props.db.get(e);case 12:if(!(a=t.sent)){t.next=19;break}return o=URL.createObjectURL(a),i.cacheUrl(e,o),t.abrupt("return",o);case 19:return s=this.api()+"/download/"+n+"/"+e,t.next=22,S.a.get(s,{responseType:"blob"}).then(function(t){return[null,t]}).catch(function(t){return[t]});case 22:if(l=t.sent,h=Object(y.a)(l,2),u=h[0],c=h[1],!u&&c.data){t.next=29;break}return console.log("file download error!"),t.abrupt("return","");case 29:return this.props.db.set(e,c.data),d=URL.createObjectURL(c.data),i.cacheUrl(e,d),t.abrupt("return",d);case 33:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t={store:this.props.store,actions:this.props.actions,database:this.props.db,functions:{url:this.url.bind(this),multiLang:this.multiLang.bind(this),dateString:this.dateString.bind(this)}};return l.a.createElement(vt,{app:t})}},{key:"componentDidMount",value:function(){this.updateWindowDimensions(),window.addEventListener("resize",this.updateWindowDimensions.bind(this))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateWindowDimensions.bind(this))}},{key:"updateWindowDimensions",value:function(){this.props.actions.ui.setDimension({width:window.innerWidth,height:window.innerHeight})}}]),e}(c.Component);function wt(t,e){return Object(O.b)(t,e)}var kt=Object(p.b)(function(t,e){return{store:t}},function(t){return{actions:{main:wt(i,t),ui:wt(r,t),modal:wt(a,t),content:wt(o,t),user:wt(s,t),report:wt(u,t)}}})(mt),jt=n(40),Ot=n.n(jt),xt=function(){function t(){Object(v.a)(this,t),this.dbPromise=Ot.a.open("database",1,function(t){t.createObjectStore("store")}),this.get=this.get.bind(this),this.set=this.set.bind(this),this.delete=this.delete.bind(this),this.clear=this.clear.bind(this)}return Object(m.a)(t,[{key:"get",value:function(t){var e=this;return this.dbPromise.then(function(e){return e.transaction("store").objectStore("store").get(t)}).catch(function(t){console.log("db error, clearing db..."),e.clear()})}},{key:"set",value:function(t,e){return this.dbPromise.then(function(n){var i=n.transaction("store","readwrite");return i.objectStore("store").put(e,t),i.complete})}},{key:"delete",value:function(t){return this.dbPromise.then(function(e){var n=e.transaction("store","readwrite");return n.objectStore("store").delete(t),n.complete})}},{key:"clear",value:function(){return this.dbPromise.then(function(t){var e=t.transaction("store","readwrite");return e.objectStore("store").clear(),e.complete})}}]),t}(),St=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{status:"init",language:"english",version:"v1.0.0"},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"setStatus":return Object(Z.a)({},t,{status:e.payload});default:return t}},Et=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{minWidth:360,maxWidth:2048,minHeight:540,maxHeight:1440,windowWidth:0,windowHeight:0,basicStyle:{width:0,height:0,display:"flex",flexFlow:"column nowrap",alignItems:"center"},styles:{container:{display:"flex",justifyContent:"center",alignItems:"center",backgroundSize:"100% 100%",flexShrink:0},area:{width:"100%",display:"flex",flexFlow:"row warp"},border:{borderStyle:"solid",borderWidth:"1px",borderColor:"#dddddd"}},colors:{green:"#91c33b",blue:"#2359a3",deepBlue:"#0a2647",textGrey:"#4a4a4a",lightGrey:"#dddddd"}},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"setDimension":var n=e.payload.width,i=e.payload.height,r=Object(Z.a)({},t.basicStyle,{width:n<t.minWidth?t.minWidth:n>t.maxWidth?t.maxWidth:.9999*n,height:i<t.minHeight?t.minHeight:i>t.maxHeight?t.maxHeight:.9999*i});return Object(Z.a)({},t,{windowWidth:n,windowHeight:i,basicStyle:r});default:return t}},Ct=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{status:"off",english:"",chinese:"",simplified_chinese:"",button:"off",onConfirm:null,onCancel:null},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"confirm":var n=e.payload;return Object(Z.a)({},t,{status:"on",button:"confirm",onConfirm:n.onConfirm,onCancel:n.onCancel,english:n.message[0],chinese:n.message[1],simplified_chinese:n.message[2]});case"message":return Object(Z.a)({},t,{status:"on",button:"on",english:e.payload[0],chinese:e.payload[1],simplified_chinese:e.payload[2]});case"loadingMessage":return Object(Z.a)({},t,{status:"on",button:"off",english:e.payload[0],chinese:e.payload[1],simplified_chinese:e.payload[2]});case"hideModal":return Object(Z.a)({},t,{status:"off",button:"off"});default:return t}},Wt=n(42),Rt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{view:"",traces:[],subView:"",cachedUrl:{}},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"cacheUrl":var n=t.cachedUrl;return n[e.payload.filename]=e.payload.url,Object(Z.a)({},t,{cachedUrl:n});case"setSubView":return Object(Z.a)({},t,{subView:e.payload});case"backToHome":return Object(Z.a)({},t,{traces:t.traces.slice(0,1),view:t.traces[0]});case"clearView":return Object(Z.a)({},t,{traces:[],view:""});case"pullView":return 0===t.traces.length?t:Object(Z.a)({},t,{traces:t.traces.slice(0,t.traces.length-1),view:t.traces[t.traces.length-2]});case"pushView":return Object(Z.a)({},t,{traces:Object(Wt.a)(t.traces).concat([e.payload]),view:e.payload});default:return t}},Vt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:"",pw:"",type:"",createdAt:""},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"setUser":return e.payload;default:return t}},It={updateElements:function(t,e,n,i){if(!e||0===e.length)return t;var r=t.slice(0);0===r.length&&(r=[e[0]]);for(var a=0;a<e.length;a++)if(e[a])for(var o=0;o<r.length;o++){if(!n&&r[o]._id===e[a]._id){r[o]=Object(Z.a)({},r[o],e[a]);break}if(n&&r[o]===e[a]){r[o]=e[a];break}if(o===r.length-1){i?r.splice(r.length,0,e[a]):r.splice(0,0,e[a]);break}}return r},getElementIndex:function(t,e){for(var n=0;n<t.length;n++)if(t[n]._id===e._id)return n}},Dt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{reports:[],viewingReport:{},currentStage:0},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"setCurrentStage":var n=e.payload;return n<0||n>4?t:Object(Z.a)({},t,{currentStage:e.payload});case"viewReport":return Object(Z.a)({},t,{viewingReport:e.payload});case"updateReports":return Object(Z.a)({},t,{reports:It.updateElements(t.reports,e.payload)});default:return t}},Mt=Object(O.c)({main:St,ui:Et,modal:Ct,content:Rt,user:Vt,report:Dt}),Ut=(n(81),n(41)),Lt=null;Lt=Object(O.a)(function(t){return function(t){return function(e){try{t(e)}catch(n){console.log("error! ",n)}}}},Ut.a);var zt=Object(O.d)(Mt,{},Lt);d.a.render(l.a.createElement(p.a,{store:zt},l.a.createElement(kt,{db:new xt})),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[43,2,1]]]);
//# sourceMappingURL=main.2c79dfdd.chunk.js.map